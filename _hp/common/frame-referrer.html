<!DOCTYPE html>
<html>

<head>
</head>

<body>
    <script>
        var urlParams = new URLSearchParams(decodeURIComponent(window.location.search));
        var id = urlParams.get("count");
        let url = urlParams.get("origin") + '/_hp/server/responses.py?feature_group=rp&resp_id=';
        let origin = urlParams.get("origin");
        let nest = urlParams.get("nest");
        let response_id = urlParams.get("resp_id");
        let element = urlParams.get("element");
        if (nest == 0) {
            if (element == "window.open") {
                window.opener.postMessage({ "id": id, "message": `document.referrer: ${document.referrer}` }, "*");
            } else {
                window.parent.postMessage({ "id": id, "message": `document.referrer: ${document.referrer}` }, "*");
            }
        } else {
            const final_url = url + response_id + `&count=${id}&nest=${nest - 1}&resp=0&origin=${origin}&element=${element}`;

            if (element == "window.open") {
                window.addEventListener("message", (e) => {
                    window.opener.postMessage(e.data, "*");
                    w.close();
                });
                const i = document.createElement('iframe');
                w = window.open(final_url);
            } else {
                window.addEventListener("message", (e) => {
                    window.parent.postMessage(e.data, "*");
                });
                const i = document.createElement('iframe');
                i.src = final_url;
                document.body.appendChild(i);
            }

        }
    </script>
</body>

</html>