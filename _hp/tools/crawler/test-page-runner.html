<!DOCTYPE html>
<html>

<head>
	<title>Test Page Runner: open one Test URL at a time from a list of Test URLs.</title>
</head>

<body>
	<script>
		// Insert URLs and timeout dynamically
		let urls = $$$URLS$$$;
		let timeout = $$$TIMEOUT$$$;
		let counter = 0;
		let openWindow;
		let timeoutId;

		function closeCurrentWindow() {
			if (openWindow) {
				openWindow.close();
			}
		}

		function openNextWindow() {
			closeCurrentWindow();

			if (counter < urls.length) {
				// interpreted as: top=min,left=min,width=min,height=min
				openWindow = window.open(urls[counter], "_blank", "top=-100,left=-100,width=0,height=0");
				counter++;
				// Open the next test after the TIMEOUT
				timeoutId = setTimeout(function () {
					openNextWindow();
				}, timeout);

			} else {
				console.log("Finished!");
				// Append a "finished" div which we can await for in Selenium/Playwright based tests
				d = document.createElement("div");
				d.id = "finished";
				document.body.appendChild(d);
			}
		}

		function handleMessage(event) {
			// If the test is finished, clear the timeout and directly start the next test
			if (event.data === 'finished') {
				clearTimeout(timeoutId);
				openNextWindow();
			}
		}
		window.addEventListener('message', handleMessage);


	</script>
</body>

</html>